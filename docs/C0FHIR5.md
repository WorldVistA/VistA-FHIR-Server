Here is the **Dashboard Integration Guide**. This document is designed for frontend developers and data engineers to help them consume the FHIR resources generated by the `C0FHIR` suite.

---

# C0FHIR: Dashboard Integration Guide

## 1. Handling the RPC Response

Because the `C0FHIR GET FULL BUNDLE` RPC returns a **Global Array**, the response from your VistA broker (e.g., EWD.js, Node-RPC, or OSEHRA Broker) will arrive as an array of strings.

### Processing the Stream

1. **Concatenate:** Join the array elements into a single string.
2. **Parse:** Convert the string into a JSON object.
3. **Validate:** Check for `resourceType: "Bundle"`.

---

## 2. Resource Processing Logic

### A. Clinical Notes (Base64)

TIU Notes are returned as `DocumentReference` resources. The text is Base64 encoded to protect special characters and line breaks during the M-to-JSON transformation.

**Integration Logic:**

```javascript
const noteResource = bundle.entry.find(e => e.resource.resourceType === 'DocumentReference');
const base64Data = noteResource.resource.content[0].attachment.data;
const plainText = atob(base64Data); // Standard browser decoding
console.log(plainText);

```

### B. Lab Observations

VistA Labs are grouped by the date/time of the specimen collection.

**Integration Logic:**

* Look for `category: "laboratory"`.
* Use `effectiveDateTime` to sort chronologically.
* `valueQuantity.value` contains the numeric result, while `valueQuantity.unit` provides the VistA-defined unit.

### C. Medications & RxNorm

To ensure your dashboard shows standard icons or drug groupings, use the `coding` array within `MedicationStatement`.

**Integration Logic:**

* Primary Text: `medicationCodeableConcept.text` (The VistA drug name).
* Standard Code: `medicationCodeableConcept.coding[0].code` (The RxNorm CUI).

---

## 3. Data Visualization Strategy

| UI Component | FHIR Source | Key Fields |
| --- | --- | --- |
| **Header** | `Patient` | `name`, `birthDate`, `gender` |
| **Timeline** | `Encounter` | `period.start`, `location.display` |
| **Trend Lines** | `Observation` | `effectiveDateTime`, `valueQuantity.value` |
| **Meds List** | `MedicationStatement` | `status`, `medicationCodeableConcept.text` |

---

## 4. Handling Errors (`OperationOutcome`)

If the VistA backend encounters a FileMan error (e.g., a security key is missing or a pointer is broken), the bundle will contain an `OperationOutcome` resource instead of clinical data.

**Error Logic:**

```javascript
if (bundle.entry.some(e => e.resource.resourceType === 'OperationOutcome')) {
    const error = bundle.entry.find(e => e.resource.resourceType === 'OperationOutcome');
    console.error("VistA Backend Error:", error.resource.issue[0].diagnostics);
}

```

---

## 5. Performance Tips

* **Pagination:** For patients with long histories, use the `SDT` and `EDT` parameters in the RPC to load data in 6-month or 1-year chunks.
* **Caching:** Store the `Patient` resource locally to avoid redundant demographic lookups during the session.

**Would you like me to provide a sample JavaScript snippet that demonstrates a full `fetch` call to a VistA VistA-REST or Broker-API using these parameters?**